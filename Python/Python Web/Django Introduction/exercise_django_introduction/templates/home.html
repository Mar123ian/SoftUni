<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
            --bg: #0b1220;
            --panel: #111a2e;
            --panel-2: #0e172a;
            --text: #e6ebf5;
            --muted: #9aa3b2;
            --primary: #4f8cff;
            --primary-600:#3d74e6;
            --ring: rgba(79,140,255,.35);
            --card: #111827;
            --card-border: #1f2937;
            --success: #10b981;
            --warning: #f59e0b;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
            background: radial-gradient(1200px 800px at 10% -10%, #16213a 0, transparent 60%),
            radial-gradient(1200px 800px at 110% 10%, #0f1a33 0, transparent 60%),
            var(--bg);
            background-attachment: fixed;
            color:var(--text);
            line-height:1.5;
        }
        .container{max-width:1100px;margin:0 auto;padding:24px}
        header{display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:20px}
        .title{font-size: clamp(20px, 3vw, 28px);font-weight:700;letter-spacing:.3px}
        .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
        .field{position:relative}
        .input{
            width:260px;max-width:100%;
            background:linear-gradient(0deg, var(--panel), var(--panel)) padding-box,
            linear-gradient(120deg, transparent, var(--ring)) border-box;
            border:1px solid var(--card-border);
            color:var(--text);
            outline:none;
            border-radius:10px;
            padding:12px 14px 12px 38px;
            transition:border-color .2s, box-shadow .2s, background .2s;
        }
        .input::placeholder{color:var(--muted)}
        .input:focus{border-color:var(--primary);box-shadow:0 0 0 6px var(--ring)}
        .search-icon{
            position:absolute;left:12px;top:50%;transform:translateY(-50%);
            width:18px;height:18px;opacity:.75;pointer-events:none
        }
        .select{
            appearance:none;-webkit-appearance:none;-moz-appearance:none;
            width:180px;max-width:100%;
            background: linear-gradient(0deg, var(--panel), var(--panel)) padding-box,
            linear-gradient(120deg, transparent, var(--ring)) border-box;
            border:1px solid var(--card-border);
            color:var(--text);
            border-radius:10px;padding:12px 40px 12px 14px;outline:none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M6 8l4 4 4-4" stroke="%239aa3b2" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            background-repeat:no-repeat;background-position:right 12px center;
        }
        .select:focus{border-color:var(--primary);box-shadow:0 0 0 6px var(--ring)}
        /* Dropdown items styling (support varies by browser) */
        .select option{
            background: var(--panel);
            color: var(--text);
            padding: 8px 10px;
        }
        .select option:hover,
        .select option:focus{
            background:#16213a;
            color:var(--text);
        }
        .select option:checked{
            background: var(--primary-600);
            color:#fff;
        }
        .select optgroup{
            background: var(--panel);
            color: var(--muted);
            font-weight:600;
        }
        .select option[disabled]{color:var(--muted)}
        @media (forced-colors: active) {
            .select { border-color: CanvasText; }
            .select option:checked { background: Highlight; color: HighlightText; }
        }
        /* WebKit/Blink scrollbar inside select (may not affect native popups) */
        .select::-webkit-scrollbar{width:8px}
        .select::-webkit-scrollbar-thumb{background:#1d2a44;border-radius:999px}
        .select::-webkit-scrollbar-track{background:#0b1222}
        .grid{display:flex;gap:14px;overflow-x:auto;padding-top:24px;align-items:flex-start;margin-top:-32px}
        .grid::-webkit-scrollbar{height:8px}
        .grid::-webkit-scrollbar-thumb{background:#1d2a44;border-radius:999px}
        .grid::-webkit-scrollbar-track{background:#0b1222}
        .card{
            background:linear-gradient(180deg, var(--panel-2), var(--card));
            border:1px solid var(--card-border);
            border-radius:14px;padding:16px;
            box-shadow:0 8px 24px rgba(0,0,0,.25);
            transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
            width:max-content;
            min-width: 240px;
            max-width: 450px;
            flex-shrink: 0;
        }
        .card:hover{transform: translateY(-2px); border-color: #2a3748; box-shadow:0 10px 28px rgba(0,0,0,.32)}
        .card h2{font-size:18px;margin:0 0 8px 0}
        .badge{
            display:inline-flex;align-items:center;gap:6px;
            font-size:12px;color:var(--muted);background:#0b1222;border:1px solid #1d2a44;
            padding:4px 8px;border-radius:999px;margin-bottom:10px
        }
        .body{color:#cbd5e1;font-size:14px;margin:0;white-space:normal;overflow-wrap:break-word;}
        .toolbar{display:flex;gap:8px;align-items:center}
        .spacer{flex:1}
        .hint{color:var(--muted);font-size:12px}
        /* Styling for span elements as requested */
        span{color:var(--text)}
        .categoryContainer{display:flex;gap:8px;align-items:center;overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding-top:6px;margin-bottom:8px;scrollbar-width:thin}
        .categoryContainer::-webkit-scrollbar{height:8px}
        .categoryContainer::-webkit-scrollbar-thumb{background:#1d2a44;border-radius:999px}
        .categoryContainer::-webkit-scrollbar-track{background:#0b1222}
        .categoryContainer span{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);background:#0b1222;border:1px solid #1d2a44;padding:4px 8px;border-radius:999px;margin:0 6px 10px 0;white-space:nowrap;flex:0 0 auto}

        @media (max-width: 620px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            .controls {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }
            .field, .input, .select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="title">Бележки</div>
        <div class="controls">
            <div class="field">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#9aa3b2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="7" stroke="#9aa3b2" stroke-width="2"/></svg>
                <input class="input" type="text" id="search-input" name="search" placeholder="Търсене...">
            </div>
            <label class="hint" for="category">Категория</label>
            <select class="select" id="category">
                <option value="all">All</option>
                {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
    </header>

    <div id="notes-container" class="grid"></div>
</div>

<script type="module">
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-input');
        const categorySelect = document.getElementById('category');
        searchInput.addEventListener('input', fetchNotes);
        categorySelect.addEventListener('change', filterByCategory);
        fetchNotes();
    });

    async function fetchNotes() {
        const containerEl = document.getElementById('notes-container');
        containerEl.replaceChildren();
        const searchValue = document.getElementById('search-input').value || '';

        const resp = await fetch('/search/?search=' + encodeURIComponent(searchValue));
        const data = await resp.json();
        const notes = data.notes || [];

        for (const note of notes) {
            const card = document.createElement('div');
            card.className = 'card';

            const header = document.createElement('h2');
            header.textContent = note.title;

            const categoryContainer = document.createElement('div');
            categoryContainer.className = 'categoryContainer';

            for (const noteCategory of (note.categories || [])) {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.textContent = noteCategory;
                categoryContainer.appendChild(badge);
            }

            const body = document.createElement('p');
            body.className = 'body';
            body.textContent = note.body;

            card.appendChild(header);
            card.appendChild(categoryContainer);
            card.appendChild(body);
            containerEl.appendChild(card);
        }

        filterByCategory();
    }

    function filterByCategory() {
        const selectedCategory = document.getElementById('category').value;
        const notes = document.getElementById('notes-container').children;

        for (const note of notes) {
            const categories = note.querySelectorAll('.categoryContainer span');
            let visible = selectedCategory === 'all';

            if (!visible) {
                for (const categoryEl of categories) {
                    if (categoryEl.textContent === selectedCategory) {
                        visible = true;
                        break;
                    }
                }
            }

            note.style.display = visible ? 'block' : 'none';
        }
    }
</script>
</body>
</html>